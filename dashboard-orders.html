<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesanan - ThriftMap</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Index page global styles to match navbar -->
    <link rel="stylesheet" href="./assets/css/style-prefix.css">
    <!-- SweetAlert2 for Notify utility -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --tm-primary: #16a34a;
            --tm-primary-dark: #15803d;
            --tm-secondary: #0f766e;
            --tm-bg: #f1f5f9;
            --tm-page: linear-gradient(180deg, #f8fafc 0%, #eefdf6 45%, #f8fafc 100%);
            --tm-surface: rgba(255, 255, 255, 0.94);
            --tm-border: rgba(15, 118, 110, 0.14);
            --tm-muted: #64748b;
            --tm-text: #0f172a;
            --tm-radius-lg: 22px;
            --tm-radius-md: 16px;
            --tm-radius-sm: 12px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--tm-page);
            color: var(--tm-text);
        }

        .tm-auto-hide-header {
            position: sticky;
            top: 0;
            z-index: 1300;
            background: #fff;
        }

        .header-main { padding: 12px 0; margin-bottom: 0; }

        .header-main .container {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .action-btn {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f8f9fa;
            color: #2c3e50;
            transition: all 0.3s ease;
        }

        .action-btn:hover,
        .action-btn:focus-visible {
            background: #27ae60;
            color: #fff;
        }

        .action-btn .count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: #fff;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: grid;
            place-items: center;
            font-size: 11px;
            font-weight: 700;
        }

        .tm-nav-dropdown { position: relative; }

        .tm-nav-dropdown .tm-dropdown-panel {
            right: 0;
            left: auto;
        }

        .order-card {
            background: var(--tm-surface);
            border-radius: var(--tm-radius-lg);
            border: 1px solid var(--tm-border);
            box-shadow: 0 8px 24px rgba(15, 118, 110, 0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .order-card:hover {
            box-shadow: 0 12px 32px rgba(15, 118, 110, 0.16);
            transform: translateY(-2px);
        }

        .order-header {
            background: linear-gradient(120deg, rgba(22, 163, 74, 0.05), rgba(20, 184, 166, 0.03));
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(15, 118, 110, 0.1);
        }

        .order-body {
            padding: 1.5rem;
        }

        .product-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(15, 118, 110, 0.08);
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            flex-shrink: 0;
            box-shadow: 0 8px 16px rgba(15, 118, 110, 0.12);
        }

        .product-details {
            flex: 1;
        }

        .order-footer {
            padding: 1rem 1.5rem;
            background: rgba(248, 250, 252, 0.8);
            border-top: 1px solid rgba(15, 118, 110, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 1rem;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-diproses {
            background: rgba(234, 179, 8, 0.15);
            color: #d97706;
        }

        .status-dikirim {
            background: rgba(59, 130, 246, 0.15);
            color: #1d4ed8;
        }

        .status-selesai {
            background: rgba(34, 197, 94, 0.15);
            color: #16a34a;
        }

        .status-dibatalkan {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
        }

        .progress-container {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(241, 245, 249, 0.7);
            border-radius: var(--tm-radius-sm);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 1rem;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 4px;
            background: #e2e8f0;
            z-index: 1;
        }

        .progress-bar {
            position: absolute;
            top: 15px;
            left: 0;
            height: 4px;
            background: var(--tm-primary);
            z-index: 2;
            transition: width 0.5s ease;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
        }

        .step-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .step-active .step-icon {
            background: var(--tm-primary);
            color: white;
        }

        .step-completed .step-icon {
            background: var(--tm-primary);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: #64748b;
            text-align: center;
        }

        .step-active .step-label {
            color: var(--tm-primary);
            font-weight: 600;
        }

        .step-completed .step-label {
            color: var(--tm-primary);
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .filter-tab {
            padding: 0.5rem 1rem;
            border-radius: 999px;
            background: rgba(248, 250, 252, 0.8);
            border: 1px solid rgba(15, 118, 110, 0.1);
            color: var(--tm-muted);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .filter-tab:hover {
            background: rgba(22, 163, 74, 0.05);
            color: var(--tm-primary-dark);
        }

        .filter-tab.active {
            background: var(--tm-primary);
            color: white;
            border-color: var(--tm-primary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--tm-muted);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }

        .stats-card {
            background: var(--tm-surface);
            border-radius: var(--tm-radius-lg);
            border: 1px solid var(--tm-border);
            box-shadow: 0 8px 24px rgba(15, 118, 110, 0.08);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stats-icon.orders {
            background: rgba(22, 163, 74, 0.1);
            color: var(--tm-primary);
        }

        .stats-icon.xp {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .stats-icon.spent {
            background: rgba(168, 85, 247, 0.1);
            color: #a855f7;
        }

        .stats-content {
            flex: 1;
        }

        .stats-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--tm-text);
            line-height: 1.2;
        }

        .stats-label {
            font-size: 0.9rem;
            color: var(--tm-muted);
        }

        .btn-primary {
            background: var(--tm-primary);
            color: white;
            border-radius: var(--tm-radius-sm);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            background: var(--tm-primary-dark);
            box-shadow: 0 8px 20px rgba(22, 163, 74, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: var(--tm-primary);
            border: 1px solid var(--tm-primary);
            border-radius: var(--tm-radius-sm);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .btn-outline:hover {
            background: rgba(22, 163, 74, 0.05);
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.15);
        }

        .tm-bottom-nav {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid var(--tm-border);
            box-shadow: 0 -18px 32px rgba(15, 118, 110, 0.12);
        }

        .tm-bottom-nav a {
            color: var(--tm-muted);
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .tm-bottom-nav a.active,
        .tm-bottom-nav a:hover {
            color: var(--tm-primary-dark);
        }

        * {
            outline: none !important;
        }

        button:focus,
        button:hover,
        button:active {
            outline: none !important;
        }

        @media (max-width: 768px) {
            .order-footer {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .order-actions {
                width: 100%;
                display: flex;
                gap: 0.5rem;
            }

            .order-actions button {
                flex: 1;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header/Navbar -->
    <header class="tm-auto-hide-header">
        <div class="header-main">
            <div class="container">
                <a href="dashboard-home.html" class="header-logo">
                    <img src="./assets/images/logo/logo.svg" alt="ThriftMap logo" width="120" height="36">
                </a>
                <div class="header-search-container">
                    <input id="globalSearch" type="search" name="search" class="search-field" placeholder="Cari pesanan, invoice...">
                    <button class="search-btn" id="globalSearchBtn">
                        <ion-icon name="search-outline"></ion-icon>
                    </button>
                </div>
                <div class="header-user-actions" style="margin-left:auto">
                    <a href="dashboard-profile.html" class="action-btn" title="Akun">
                        <ion-icon name="person-outline"></ion-icon>
                    </a>
                    <a href="dashboard-cart.html" class="action-btn" title="Keranjang">
                        <ion-icon name="bag-handle-outline"></ion-icon>
                        <span class="count cart-count" style="display:none">0</span>
                    </a>
                    <button type="button" class="action-btn" data-open-wishlist title="Wishlist">
                        <ion-icon name="heart-outline"></ion-icon>
                        <span class="count wish-count" style="display:none">0</span>
                    </button>
                    <div class="tm-nav-dropdown">
                        <button class="action-btn" id="globalMenuBtn" aria-haspopup="true" aria-expanded="false" title="Menu">
                            <ion-icon name="menu-outline"></ion-icon>
                        </button>
                        <div class="tm-dropdown-panel hidden" id="globalMenu">
                            <a href="dashboard-home.html"><span class="label"><ion-icon name="home-outline"></ion-icon> Beranda</span></a>
                            <a href="dashboard-products.html"><span class="label"><ion-icon name="storefront-outline"></ion-icon> Produk</span></a>
                            <a href="dashboard-orders.html"><span class="label"><ion-icon name="bag-check-outline"></ion-icon> Pesanan</span><span class="badge orders-count" style="display:none">0</span></a>
                            <a href="dashboard-tracking.html"><span class="label"><ion-icon name="location-outline"></ion-icon> Lacak</span></a>
                            <a href="dashboard-settings.html"><span class="label"><ion-icon name="settings-outline"></ion-icon> Pengaturan</span></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Content -->
    <main class="max-w-7xl mx-auto px-4 md:px-8 py-6 pb-24 mt-3">
        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 stats-grid">
            <div class="stats-card">
                <div class="stats-icon orders">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <div class="stats-content">
                    <div class="stats-value" id="totalOrders">0</div>
                    <div class="stats-label">Total Pesanan</div>
                </div>
            </div>
            <div class="stats-card">
                <div class="stats-icon xp">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="stats-content">
                    <div class="stats-value" id="totalXP">0 XP</div>
                    <div class="stats-label">XP Diperoleh</div>
                </div>
            </div>
            <div class="stats-card">
                <div class="stats-icon spent">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stats-content">
                    <div class="stats-value" id="totalSpent">Rp 0</div>
                    <div class="stats-label">Total Pengeluaran</div>
                </div>
            </div>
        </div>

        <!-- Filter Tabs -->
        <div class="filter-tabs" id="statusFilter">
            <div class="filter-tab active" data-status="all">Semua Pesanan</div>
            <div class="filter-tab" data-status="diproses">Diproses</div>
            <div class="filter-tab" data-status="dikirim">Dikirim</div>
            <div class="filter-tab" data-status="selesai">Selesai</div>
            <div class="filter-tab" data-status="dibatalkan">Dibatalkan</div>
        </div>

        <!-- Orders Container -->
        <div id="ordersContainer">
            <!-- Orders will be injected here -->
        </div>
    </main>

    <!-- Mobile Bottom Navigation -->
    <nav class="tm-bottom-nav fixed bottom-0 inset-x-0 z-40 md:hidden">
        <div class="flex justify-around py-2 text-xs">
            <a data-nav href="dashboard-home.html" class="flex flex-col items-center gap-1">
                <i class="fas fa-home text-base"></i>
                <span>Home</span>
            </a>
            <a data-nav href="dashboard-products.html" class="flex flex-col items-center gap-1">
                <i class="fas fa-tags text-base"></i>
                <span>Produk</span>
            </a>
            <a data-nav href="dashboard-orders.html" class="flex flex-col items-center gap-1 active">
                <i class="fas fa-shopping-bag text-base"></i>
                <span>Pesanan</span>
            </a>
            <a data-nav href="dashboard-tracking.html" class="flex flex-col items-center gap-1">
                <i class="fas fa-map-marker-alt text-base"></i>
                <span>Lacak</span>
            </a>
            <a data-nav href="dashboard-profile.html" class="flex flex-col items-center gap-1">
                <i class="fas fa-user text-base"></i>
                <span>Profil</span>
            </a>
        </div>
    </nav>

    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <!-- Notify helper -->
    <script src="./assets/js/notify.js"></script>
    
    <script>
        // Global menu dropdown & bottom nav active
        (function(){
            const btn = document.getElementById('globalMenuBtn');
            const menu = document.getElementById('globalMenu');
            if (btn && menu) {
                btn.addEventListener('click', () => {
                    const expanded = btn.getAttribute('aria-expanded') === 'true';
                    btn.setAttribute('aria-expanded', String(!expanded));
                    menu.classList.toggle('hidden');
                });
                document.addEventListener('click', (e) => {
                    if (!menu.contains(e.target) && e.target !== btn && !btn.contains(e.target)) {
                        menu.classList.add('hidden');
                        btn.setAttribute('aria-expanded', 'false');
                    }
                });
            }
            document.querySelectorAll('a[data-nav]').forEach(a => {
                const href = a.getAttribute('href') || '';
                if (location.pathname.endsWith(href)) {
                    a.classList.add('active');
                    a.setAttribute('aria-current', 'page');
                }
            });
        })();

        // Initial badge sync (orders & wishlist)
        (function(){
            const menu = document.getElementById('globalMenu');
            if (!menu) return;
            try {
                const orders = parseInt(localStorage.getItem('tm_orders_count')||'0',10) || 0;
                const wishList = JSON.parse(localStorage.getItem('tm_wishlist')||'[]');
                const wCount = Array.isArray(wishList) ? wishList.length : (parseInt(localStorage.getItem('tm_wishlist_count')||'0',10) || 0);
                const oEl = menu.querySelector('.orders-count');
                const wEl = menu.querySelector('.wish-count');
                if (oEl) { 
                    if (orders>0){ 
                        oEl.style.display='inline-block'; 
                        oEl.textContent=String(orders);
                    } else { 
                        oEl.style.display='none'; 
                    } 
                }
                if (wEl) { 
                    if (wCount>0){ 
                        wEl.style.display='inline-block'; 
                        wEl.textContent=String(wCount);
                    } else { 
                        wEl.style.display='none'; 
                    } 
                }
            } catch {}
        })();

        // Orders data
        const ORDERS_KEY = 'tm_orders_history_v1';
        const ordersContainer = document.getElementById('ordersContainer');
        const statusFilter = document.getElementById('statusFilter');
        const totalOrdersEl = document.getElementById('totalOrders');
        const totalXPEl = document.getElementById('totalXP');
        const totalSpentEl = document.getElementById('totalSpent');

        // Sample orders data
        const sampleOrders = [
            {
                id: "TM-2023-00125",
                date: "15 Nov 2023",
                status: "diproses",
                progress: 2, // 0-4 steps
                total: 185000,
                xpEarned: 25,
                products: [
                    {
                        name: "Jaket Kulit Pria Vintage",
                        image: "./assets/images/products/jacket-3.jpg",
                        price: 125000,
                        quantity: 1,
                        variant: "Hitam, Size L"
                    },
                    {
                        name: "Kaos Graphic Limited Edition",
                        image: "./assets/images/products/shirt-1.jpg",
                        price: 60000,
                        quantity: 1,
                        variant: "Putih, Size M"
                    }
                ],
                shipping: {
                    method: "Reguler",
                    tracking: "TM-987654321",
                    address: "Jl. Merdeka No. 123, Jakarta"
                }
            },
            {
                id: "TM-2023-00124",
                date: "12 Nov 2023",
                status: "dikirim",
                progress: 3, // 0-4 steps
                total: 275000,
                xpEarned: 35,
                products: [
                    {
                        name: "Sepatu Sneakers Casual",
                        image: "./assets/images/products/shoe-1.jpg",
                        price: 275000,
                        quantity: 1,
                        variant: "Putih, Size 42"
                    }
                ],
                shipping: {
                    method: "Express",
                    tracking: "TM-123456789",
                    address: "Jl. Sudirman No. 456, Bandung"
                }
            },
            {
                id: "TM-2023-00123",
                date: "10 Nov 2023",
                status: "selesai",
                progress: 4, // 0-4 steps
                total: 89000,
                xpEarned: 15,
                products: [
                    {
                        name: "Tas Mini Wanita",
                        image: "./assets/images/products/bag-1.png",
                        price: 89000,
                        quantity: 1,
                        variant: "Hitam"
                    }
                ],
                shipping: {
                    method: "Reguler",
                    tracking: "TM-456789123",
                    address: "Jl. Asia Afrika No. 789, Surabaya"
                }
            },
            {
                id: "TM-2023-00122",
                date: "05 Nov 2023",
                status: "dibatalkan",
                progress: 1, // 0-4 steps
                total: 150000,
                xpEarned: 0,
                products: [
                    {
                        name: "Dress Floral Midi",
                        image: "./assets/images/products/clothes-3.jpg",
                        price: 150000,
                        quantity: 1,
                        variant: "Navy Floral, Size M"
                    }
                ],
                shipping: {
                    method: "Reguler",
                    tracking: "",
                    address: "Jl. Gajah Mada No. 321, Yogyakarta"
                }
            }
        ];

        // Initialize orders if not exists
        function initializeOrders() {
            if (!localStorage.getItem(ORDERS_KEY)) {
                localStorage.setItem(ORDERS_KEY, JSON.stringify(sampleOrders));
            }
        }

        // Get orders from localStorage
        function getOrders() {
            try {
                return JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
            } catch {
                return [];
            }
        }

        // Render orders based on filter
        function renderOrders(statusFilter = 'all') {
            const orders = getOrders();
            ordersContainer.innerHTML = '';
            
            if (orders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-bag"></i>
                        <h3 class="text-lg font-semibold mb-2">Belum ada pesanan</h3>
                        <p class="mb-4">Yuk, jelajahi produk thrift dan mulai berbelanja!</p>
                        <a href="dashboard-products.html" class="btn-primary">
                            <i class="fas fa-shopping-cart mr-2"></i>Belanja Sekarang
                        </a>
                    </div>
                `;
                return;
            }

            const filteredOrders = statusFilter === 'all' 
                ? orders 
                : orders.filter(order => order.status === statusFilter);

            if (filteredOrders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-filter"></i>
                        <h3 class="text-lg font-semibold mb-2">Tidak ada pesanan dengan status ini</h3>
                        <p>Coba pilih filter status yang berbeda</p>
                    </div>
                `;
                return;
            }

            filteredOrders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card mb-6';
                
                // Status badge text
                const statusText = {
                    'diproses': 'Diproses',
                    'dikirim': 'Dikirim',
                    'selesai': 'Selesai',
                    'dibatalkan': 'Dibatalkan'
                };
                
                orderCard.innerHTML = `
                    <div class="order-header">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
                            <div>
                                <h3 class="font-bold text-gray-800">${order.id}</h3>
                                <p class="text-sm text-gray-500">${order.date}</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="status-badge status-${order.status}">
                                    <i class="fas ${getStatusIcon(order.status)}"></i>
                                    ${statusText[order.status]}
                                </span>
                                <span class="text-sm font-semibold text-gray-800">Rp ${order.total.toLocaleString('id-ID')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="order-body">
                        ${order.status !== 'dibatalkan' ? renderProgress(order.progress) : ''}
                        
                        <div class="products-list">
                            ${order.products.map(product => `
                                <div class="product-item">
                                    <img src="${product.image}" alt="${product.name}" class="product-image">
                                    <div class="product-details">
                                        <h4 class="font-semibold text-gray-800">${product.name}</h4>
                                        <p class="text-sm text-gray-600">${product.variant}</p>
                                        <p class="text-sm text-gray-600">Jumlah: ${product.quantity}</p>
                                        <p class="text-sm font-medium text-gray-800">Rp ${product.price.toLocaleString('id-ID')}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${order.shipping ? `
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-truck text-gray-600"></i>
                                    <span class="font-medium text-gray-800">Pengiriman ${order.shipping.method}</span>
                                </div>
                                ${order.shipping.tracking ? `
                                    <p class="text-sm text-gray-600">No. Resi: ${order.shipping.tracking}</p>
                                ` : ''}
                                <p class="text-sm text-gray-600">${order.shipping.address}</p>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="order-footer">
                        <div class="flex items-center gap-4">
                            ${order.xpEarned > 0 ? `
                                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-amber-100 text-amber-800 text-sm font-medium">
                                    <i class="fas fa-trophy"></i>
                                    +${order.xpEarned} XP
                                </span>
                            ` : ''}
                        </div>
                        <div class="order-actions flex gap-2">
                            <button class="btn-outline" onclick="viewOrderDetail('${order.id}')">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                            ${order.status === 'dikirim' ? `
                                <button class="btn-primary" onclick="trackOrder('${order.id}')">
                                    <i class="fas fa-map-marker-alt"></i> Lacak
                                </button>
                            ` : ''}
                            <button class="btn-outline" onclick="downloadInvoice('${order.id}')">
                                <i class="fas fa-download"></i> Invoice
                            </button>
                        </div>
                    </div>
                `;
                
                ordersContainer.appendChild(orderCard);
            });
        }

        // Render progress bar
        function renderProgress(step) {
            const steps = [
                { label: "Pesanan Diterima", icon: "fa-clipboard-check" },
                { label: "Diproses", icon: "fa-cog" },
                { label: "Dikirim", icon: "fa-shipping-fast" },
                { label: "Selesai", icon: "fa-check-circle" }
            ];
            
            const progressWidth = (step / (steps.length - 1)) * 100;
            
            return `
                <div class="progress-container">
                    <div class="progress-steps">
                        <div class="progress-bar" style="width: ${progressWidth}%"></div>
                        ${steps.map((s, i) => {
                            let stepClass = "progress-step";
                            if (i < step) stepClass += " step-completed";
                            if (i === step) stepClass += " step-active";
                            
                            return `
                                <div class="${stepClass}">
                                    <div class="step-icon">
                                        <i class="fas ${s.icon}"></i>
                                    </div>
                                    <div class="step-label">${s.label}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Get status icon
        function getStatusIcon(status) {
            const icons = {
                'diproses': 'fa-cog',
                'dikirim': 'fa-shipping-fast',
                'selesai': 'fa-check-circle',
                'dibatalkan': 'fa-times-circle'
            };
            return icons[status] || 'fa-question-circle';
        }

        // Update stats
        function updateStats() {
            const orders = getOrders();
            const totalOrders = orders.length;
            const totalXP = orders.reduce((sum, order) => sum + (order.xpEarned || 0), 0);
            const totalSpent = orders.reduce((sum, order) => sum + order.total, 0);
            
            totalOrdersEl.textContent = totalOrders;
            totalXPEl.textContent = `${totalXP} XP`;
            totalSpentEl.textContent = `Rp ${totalSpent.toLocaleString('id-ID')}`;
        }

        // Filter orders by status
        function filterOrders(status, triggerEl) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (triggerEl) {
                triggerEl.classList.add('active');
            }
            
            // Render filtered orders
            renderOrders(status);
        }

        // Order actions
        function viewOrderDetail(orderId) {
            if (window.Notify && typeof Notify.alertInfo === 'function') {
                Notify.alertInfo('Detail Pesanan', `Menampilkan detail pesanan ${orderId}`);
            } else {
                alert(`Menampilkan detail pesanan: ${orderId}`);
            }
            // In a real app, this would navigate to order detail page
        }

        function trackOrder(orderId) {
            if (window.Notify && typeof Notify.toastInfo === 'function') {
                Notify.toastInfo(`Melacak pesanan ${orderId}`);
            } else {
                alert(`Melacak pesanan: ${orderId}`);
            }
            // In a real app, this would navigate to tracking page
        }

        function downloadInvoice(orderId) {
            if (window.Notify && typeof Notify.toastSuccess === 'function') {
                Notify.toastSuccess(`Invoice ${orderId} sedang disiapkan`);
            } else {
                alert(`Mengunduh invoice untuk: ${orderId}`);
            }
            // In a real app, this would download the invoice
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeOrders();
            updateStats();
            renderOrders();
            
            // Add event listeners to filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', (evt) => {
                    filterOrders(tab.dataset.status, evt.currentTarget);
                });
            });
            
            // Global search functionality
            const globalSearch = document.getElementById('globalSearch');
            const globalSearchBtn = document.getElementById('globalSearchBtn');
            
            if (globalSearch && globalSearchBtn) {
                globalSearchBtn.addEventListener('click', () => {
                    const query = globalSearch.value.toLowerCase();
                    if (query) {
                        // In a real app, this would filter orders by query
                        alert(`Mencari: ${query}`);
                    }
                });
                
                globalSearch.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        globalSearchBtn.click();
                    }
                });
            }
        });
    </script>
</body>
</html>